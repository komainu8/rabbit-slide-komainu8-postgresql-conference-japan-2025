# PostgreSQLでのセマンティックサーチへの挑戦

author
: 堀本 泰弘

institution
: 株式会社クリアコード

content-source
: PostgreSQL Conference Japan 2025

date
: 2025-11-21

start-time
: 2025-11-21T16:20:00+09:00

end-time
: 2025-11-21T17:05:00+09:00

theme
: .

# 本日のテーマ

セマンティックサーチ

# セマンティックサーチ？

# セマンティックサーチとは？

| 従来の検索 | 字面で検索 |
| セマンティックサーチ | 意味で検索 |

# セマンティックサーチの利点

意味で検索できると何が良いのでしょうか？

# 字面で検索

検索キーワード：「牛乳」

「牛乳」：Match！
「ミルク」：Not match！

# 字面で検索

形が違うとヒットしない

# 意味で検索

検索キーワード：「牛乳」

「牛乳」：Match！
「ミルク」：Match！

# 意味で検索

形が違ってもヒットする

# セマンティックサーチの利点

| 字面での検索 | 「牛乳」と「ミルク」は違うもの |
| 意味での検索 | 「牛乳」と「ミルク」は同じようなもの |

# 字面が違う文字列の検索

従来の検索では、字面が違う文字列をどうやって検索しているのでしょうか？

# 字面が違う文字列の検索

同義語辞書

# 同義語辞書のデメリット

メンテナンスコスト：高い
未知語への対応：辞書に未定義だと対応できない

# セマンティックサーチの利点

辞書のメンテナンスコスト：なし（辞書不要）
未知語への対応：一般的な語なら辞書なしでも対応できる

# セマンティックサーチの利点

誤記にも対応できる

# セマンティックサーチの利点

「テクノロジー」と「テノクロジー」

# 活用例

実際にどのように使えるかを見てみましょう

# 活用例

活用例の紹介

# PGroongaの導入方法

これらの機能を使うにはPGroongaが必要です

# PGroongaの導入方法

PostgreSQLの拡張として実装

# PGroongaの導入方法

```sql
CREATE EXTENSION pgroonga;
```

# PGroongaの導入方法

インストール方法：
https://pgroonga.github.io/ja/install/

# セマンティクサーチの仕組み

# セマンティクサーチの仕組み

では、意味で検索の「意味」とはなんでしょうか？

# セマンティクサーチの仕組み

「意味」 = ベクトル

# セマンティクサーチの仕組み

テキストデータ -> LLM -> ベクトル

# セマンティクサーチの仕組み

「意味」の近い/遠い -> ベクトル同士の距離

# セマンティクサーチの仕組み

1. 登録するデータ -> LLM -> ベクトルデータ
2. 検索キーワード -> LLM -> ベクトルデータ

1と2の距離（類似度）を計算

# セマンティクサーチの仕組み

ベクトル表現することで”距離が計算できる”

# セマンティクサーチの仕組み

距離や類似度のおもな計算方法

* ユークリッド距離
* マンハッタン距離
* コサイン類似度

# セマンティックサーチの課題

距離（類似度）を計算して検索を実行

# セマンティックサーチの課題

すべてのベクトルデータの距離を計算？：X

# セマンティックサーチの課題

線形探索になってしまう

# セマンティックサーチの課題

検索対象のデータをすべてベクトルデータに変換して保持？

# セマンティックサーチの課題

大規模なデータでサイズが非常に大きくなる

# セマンティックサーチの課題

データサイズが大きいとメモリーに乗らず遅い

# 解決方法

線形探索：近似最近傍検索
データサイズ：圧縮

# 近似最近傍検索

ある程度の正確性を捨てて、入力したベクトルデータとだいたい同じデータを探します

# ベクトルデータの圧縮

ベクトルデータの圧縮方法はいくつかありますが今回PGroongaで採用したのはRaBitQという圧縮方法です

# ベクトルデータの圧縮

RaBitQの仕組み

# PGroongaへの組み込み

PGroonga内でどのように実装しているか

# PostgreSQLでのセマンティックサーチへの挑戦

author
: 堀本 泰弘

institution
: 株式会社クリアコード

content-source
: PostgreSQL Conference Japan 2025

date
: 2025-11-21

start-time
: 2025-11-21T16:20:00+09:00

end-time
: 2025-11-21T17:05:00+09:00

theme
: .

# 本日のテーマ

セマンティックサーチ

# セマンティックサーチ？

# セマンティックサーチとは？

| 従来の検索 | 字面で検索 |
| セマンティックサーチ | 意味で検索 |

# セマンティックサーチの利点

意味で検索できると何が良いのか？

# セマンティックサーチの利点

皆さんは以下の２つの文が同じ意味だとわかりますね？

* 私は朝、牛乳を一杯飲んだ。
* 私は朝、ミルクを一杯飲んだ。

# セマンティックサーチの利点

なぜ、同じ意味だとわかるのでしょう？

# セマンティックサーチの利点

この2つの文の違いは「牛乳」と「ミルク」ですが、この言葉が同じ意味であることを知っているからです

# セマンティックサーチの利点

字面での検索では、「牛乳」と「ミルク」が同じ意味であることがわかりません

# セマンティックサーチの利点

形が違うからです

# セマンティックサーチの利点

このような同義語を扱う場合、字面での検索では「牛乳」と「ミルク」が同じ意味であることを別途定義する必要があります

# セマンティックサーチの利点

同義語辞書を定義するわけなのですが、一般的に辞書のメンテナンスはコストが高いです

# セマンティックサーチの利点

新しい同義語が見つかったら、それを辞書に登録の繰り替えしです

# セマンティックサーチの利点

でも、意味で検索できるならどうでしょうか？

# セマンティックサーチの利点

わざわざ辞書を用意しなくてもよいのではないでしょうか？

# セマンティックサーチの利点

意味で検索するなら、「牛乳」と「ミルク」は同じものとして扱えるはずです。

# セマンティクサーチの仕組み

では、意味の近い/遠いをどう判断しているのでしょうか？

# セマンティクサーチの仕組み

近い/遠いは距離なので、何かしらの基準で言葉の意味を数値として表現できればいいはずです

# セマンティクサーチの仕組み

昨今では、LLM(大規模言語モデル)を使って言葉の意味をベクトルデータとして表現できます

# セマンティクサーチの仕組み

1. 登録するデータ -> LLM -> ベクトルデータ
2. 検索キーワード -> LLM -> ベクトルデータ

# セマンティクサーチの仕組み

1,2で生成したベクトルデータの距離を計算すれば、意味の近い/遠いを判断できます

# セマンティクサーチの仕組み

ベクトルデータの距離はベクトルの内積を計算すれば算出できます

# セマンティクサーチの仕組み

ナイーブな実装では、変換したベクトルデータ同士の内積を計算して類似度の高い（距離の近い）ベクトルデータを返します

# 効率的な検索

距離の近いベクトルデータを検索しますが、すべてのベクトルデータの距離を計算するのは現実的ではありません

# 効率的な検索

よって何かしらの方法で、効率化する必要があります。

# 近似最近傍検索

# 近似最近傍検索とは？

ある程度の正確性を捨てて、入力したベクトルデータとだいたい同じデータを探します

# 近似最近傍検索の課題

検索対象のデータをすべてベクトルデータに変換して保持すると、大規模なデータでサイズが非常に大きくなります

# 近似最近傍検索の課題

データサイズが大きいとメモリーに乗らずに性能が出ません

# 近似最近傍検索の課題

保存するベクトルデータを効率的に圧縮する必要があります

# ベクトルデータの圧縮

ベクトルデータの圧縮方法はいくつかありますが今回PGroongaで採用したのはRaBitQという圧縮方法です

# ベクトルデータの圧縮

RaBitQの仕組みとか説明

# PGroongaでのセマンティックサーチ

では、PGroongaで実装したセマンティックサーチを実際に見てみましょう

# PGroongaでのセマンティックサーチ

デモやってみる

# 活用事例

...

